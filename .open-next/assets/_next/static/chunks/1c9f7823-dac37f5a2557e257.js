"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[490],{41913:(e,t,s)=>{s.d(t,{UU:()=>nv});var n,i,r,o,c,a=s(62248),h=s(65389),l=s(55594),p=s(93355),u=s(11406),d=s(56883),m=s(1366),w=Object.create,f=Object.defineProperty,x=Object.getOwnPropertyDescriptor,y=Object.getOwnPropertyNames,g=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty,O=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)(function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),S=(e,t)=>function(){return t||(0,e[y(e)[0]])((t={exports:{}}).exports,t),t.exports},E=(e,t,s,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of y(t))b.call(e,i)||i===s||f(e,i,{get:()=>t[i],enumerable:!(n=x(t,i))||n.enumerable});return e},R=(e,t,s)=>(s=null!=e?w(g(e)):{},E(!t&&e&&e.__esModule?s:f(s,"default",{value:e,enumerable:!0}),e)),v=S({"node_modules/crypto-js/core.js"(e,t){var s,n;s=e,n=function(){var e=e||function(e,t){if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&"undefined"!=typeof global&&global.crypto&&(s=global.crypto),!s&&"function"==typeof O)try{s=O("crypto")}catch(e){}var s,n=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),r={},o=r.lib={},c=o.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=c.extend({init:function(e,s){e=this.words=e||[],s!=t?this.sigBytes=s:this.sigBytes=4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,s=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var r=0;r<i;r++){var o=s[r>>>2]>>>24-r%4*8&255;t[n+r>>>2]|=o<<24-(n+r)%4*8}else for(var c=0;c<i;c+=4)t[n+c>>>2]=s[c>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=0xffffffff<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(n());return new a.init(t,e)}}),h=r.enc={},l=h.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],i=0;i<s;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n+=2)s[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(s,t/2)}},p=h.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,n=[],i=0;i<s;i++){var r=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(r))}return n.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n++)s[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(s,t)}},u=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},d=o.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,n=this._data,i=n.words,r=n.sigBytes,o=this.blockSize,c=r/(4*o),h=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*o,l=e.min(4*h,r);if(h){for(var p=0;p<h;p+=o)this._doProcessBlock(i,p);s=i.splice(0,h),n.sigBytes-=l}return new a.init(s,l)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=d.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new m.HMAC.init(e,s).finalize(t)}}});var m=r.algo={};return r}(Math);return e},"object"==typeof e?t.exports=e=n():"function"==typeof define&&define.amd?define([],n):s.CryptoJS=n()}}),A=S({"node_modules/crypto-js/enc-hex.js"(e,t){var s,n;s=e,n=function(e){return e.enc.Hex},"object"==typeof e?t.exports=e=n(v()):"function"==typeof define&&define.amd?define(["./core"],n):n(s.CryptoJS)}}),T=S({"node_modules/crypto-js/sha1.js"(e,t){var s,n;s=e,n=function(e){var t,s,n,i,r,o;return s=(t=e.lib).WordArray,n=t.Hasher,i=e.algo,r=[],o=i.SHA1=n.extend({_doReset:function(){this._hash=new s.init([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0])},_doProcessBlock:function(e,t){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],c=s[3],a=s[4],h=0;h<80;h++){if(h<16)r[h]=0|e[t+h];else{var l=r[h-3]^r[h-8]^r[h-14]^r[h-16];r[h]=l<<1|l>>>31}var p=(n<<5|n>>>27)+a+r[h];h<20?p+=(i&o|~i&c)+0x5a827999:h<40?p+=(i^o^c)+0x6ed9eba1:h<60?p+=(i&o|i&c|o&c)-0x70e44324:p+=(i^o^c)-0x359d3e2a,a=c,c=o,o=i<<30|i>>>2,i=n,n=p}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+c|0,s[4]=s[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[(n+64>>>9<<4)+14]=Math.floor(s/0x100000000),t[(n+64>>>9<<4)+15]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA1=n._createHelper(o),e.HmacSHA1=n._createHmacHelper(o),e.SHA1},"object"==typeof e?t.exports=e=n(v()):"function"==typeof define&&define.amd?define(["./core"],n):n(s.CryptoJS)}}),k=R(A(),1),_=R(T(),1),N=Object.defineProperty;((e,t)=>{for(var s in t)N(e,s,{get:t[s],enumerable:!0})})({},{UpstashError:()=>z,UrlError:()=>P});var z=class extends Error{constructor(e){super(e),this.name="UpstashError"}},P=class extends Error{constructor(e){super(`Upstash Redis client was passed an invalid URL. You should pass a URL starting with https. Received: "${e}". `),this.name="UrlError"}},I=class{baseUrl;headers;options;readYourWrites;upstashSyncToken="";hasCredentials;retry;constructor(e){if(this.options={backend:e.options?.backend,agent:e.agent,responseEncoding:e.responseEncoding??"base64",cache:e.cache,signal:e.signal,keepAlive:e.keepAlive??!0},this.upstashSyncToken="",this.readYourWrites=e.readYourWrites??!0,this.baseUrl=(e.baseUrl||"").replace(/\/$/,""),this.baseUrl&&!/^https?:\/\/[^\s#$./?].\S*$/.test(this.baseUrl))throw new P(this.baseUrl);this.headers={"Content-Type":"application/json",...e.headers},this.hasCredentials=!!(this.baseUrl&&this.headers.authorization.split(" ")[1]),"base64"===this.options.responseEncoding&&(this.headers["Upstash-Encoding"]="base64"),this.retry="boolean"!=typeof e.retry||e.retry?{attempts:e.retry?.retries??5,backoff:e.retry?.backoff??(e=>50*Math.exp(e))}:{attempts:1,backoff:()=>0}}mergeTelemetry(e){this.headers=C(this.headers,"Upstash-Telemetry-Runtime",e.runtime),this.headers=C(this.headers,"Upstash-Telemetry-Platform",e.platform),this.headers=C(this.headers,"Upstash-Telemetry-Sdk",e.sdk)}async request(e){let t={cache:this.options.cache,method:"POST",headers:this.headers,body:JSON.stringify(e.body),keepalive:this.options.keepAlive,agent:this.options.agent,signal:this.options.signal,backend:this.options.backend};if(this.hasCredentials||console.warn("[Upstash Redis] Redis client was initialized without url or token. Failed to execute command."),this.readYourWrites){let e=this.upstashSyncToken;this.headers["upstash-sync-token"]=e}let s=null,n=null;for(let i=0;i<=this.retry.attempts;i++)try{s=await fetch([this.baseUrl,...e.path??[]].join("/"),t);break}catch(e){if(this.options.signal?.aborted){s=new Response(new Blob([JSON.stringify({result:this.options.signal.reason??"Aborted"})]),{status:200,statusText:this.options.signal.reason??"Aborted"});break}n=e,await new Promise(e=>setTimeout(e,this.retry.backoff(i)))}if(!s)throw n??Error("Exhausted all retries");let i=await s.json();if(!s.ok)throw new z(`${i.error}, command was: ${JSON.stringify(e.body)}`);if(this.readYourWrites){let e=s.headers;this.upstashSyncToken=e.get("upstash-sync-token")??""}if(this.readYourWrites){let e=s.headers;this.upstashSyncToken=e.get("upstash-sync-token")??""}return"base64"===this.options.responseEncoding?Array.isArray(i)?i.map(({result:e,error:t})=>({result:j(e),error:t})):{result:j(i.result),error:i.error}:i}};function U(e){let t="";try{let s=atob(e),n=s.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=s.charCodeAt(e);t=new TextDecoder().decode(i)}catch{t=e}return t}function j(e){let t;switch(typeof e){case"undefined":return e;case"number":t=e;break;case"object":t=Array.isArray(e)?e.map(e=>"string"==typeof e?U(e):Array.isArray(e)?e.map(e=>j(e)):e):null;break;case"string":t="OK"===e?"OK":U(e)}return t}function C(e,t,s){return s&&(e[t]=e[t]?[e[t],s].join(","):s),e}function D(e){try{return function e(t){let s=Array.isArray(t)?t.map(t=>{try{return e(t)}catch{return t}}):JSON.parse(t);return"number"==typeof s&&s.toString()!==t?t:s}(e)}catch{return e}}function M(e){return[e[0],...D(e.slice(1))]}var L=e=>{switch(typeof e){case"string":case"number":case"boolean":return e;default:return JSON.stringify(e)}},B=class{command;serialize;deserialize;constructor(e,t){if(this.serialize=L,this.deserialize=t?.automaticDeserialization===void 0||t.automaticDeserialization?t?.deserialize??D:e=>e,this.command=e.map(e=>this.serialize(e)),t?.latencyLogging){let e=this.exec.bind(this);this.exec=async t=>{let s=performance.now(),n=await e(t),i=(performance.now()-s).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.command[0].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${i} ms\x1b[0m`),n}}}async exec(e){let{result:t,error:s}=await e.request({body:this.command,upstashSyncToken:e.upstashSyncToken});if(s)throw new z(s);if(void 0===t)throw TypeError("Request did not return a result");return this.deserialize(t)}},J=class extends B{constructor(e,t){let s=["hrandfield",e[0]];"number"==typeof e[1]&&s.push(e[1]),e[2]&&s.push("WITHVALUES"),super(s,{deserialize:e[2]?e=>(function(e){if(0===e.length)return null;let t={};for(;e.length>=2;){let s=e.shift(),n=e.shift();try{t[s]=JSON.parse(n)}catch{t[s]=n}}return t})(e):t?.deserialize,...t})}},H=class extends B{constructor(e,t){super(["append",...e],t)}},$=class extends B{constructor([e,t,s],n){let i=["bitcount",e];"number"==typeof t&&i.push(t),"number"==typeof s&&i.push(s),super(i,n)}},q=class{constructor(e,t,s,n=e=>e.exec(this.client)){this.client=t,this.opts=s,this.execOperation=n,this.command=["bitfield",...e]}command;chain(...e){return this.command.push(...e),this}get(...e){return this.chain("get",...e)}set(...e){return this.chain("set",...e)}incrby(...e){return this.chain("incrby",...e)}overflow(e){return this.chain("overflow",e)}exec(){let e=new B(this.command,this.opts);return this.execOperation(e)}},W=class extends B{constructor(e,t){super(["bitop",...e],t)}},Y=class extends B{constructor(e,t){super(["bitpos",...e],t)}},F=class extends B{constructor([e,t,s],n){super(["COPY",e,t,...s?.replace?["REPLACE"]:[]],{...n,deserialize:e=>e>0?"COPIED":"NOT_COPIED"})}},K=class extends B{constructor(e){super(["dbsize"],e)}},X=class extends B{constructor(e,t){super(["decr",...e],t)}},V=class extends B{constructor(e,t){super(["decrby",...e],t)}},G=class extends B{constructor(e,t){super(["del",...e],t)}},Q=class extends B{constructor(e,t){super(["echo",...e],t)}},Z=class extends B{constructor([e,t,s],n){super(["eval",e,t.length,...t,...s??[]],n)}},ee=class extends B{constructor([e,t,s],n){super(["evalsha",e,t.length,...t,...s??[]],n)}},et=class extends B{constructor(e,t){super(["exists",...e],t)}},es=class extends B{constructor(e,t){super(["expire",...e.filter(Boolean)],t)}},en=class extends B{constructor(e,t){super(["expireat",...e],t)}},ei=class extends B{constructor(e,t){let s=["flushall"];e&&e.length>0&&e[0].async&&s.push("async"),super(s,t)}},er=class extends B{constructor([e],t){let s=["flushdb"];e?.async&&s.push("async"),super(s,t)}},eo=class extends B{constructor([e,t,...s],n){let i=["geoadd",e];"nx"in t&&t.nx?i.push("nx"):"xx"in t&&t.xx&&i.push("xx"),"ch"in t&&t.ch&&i.push("ch"),"latitude"in t&&t.latitude&&i.push(t.longitude,t.latitude,t.member),i.push(...s.flatMap(({latitude:e,longitude:t,member:s})=>[t,e,s])),super(i,n)}},ec=class extends B{constructor([e,t,s,n="M"],i){super(["GEODIST",e,t,s,n],i)}},ea=class extends B{constructor(e,t){let[s]=e;super(["GEOHASH",s,...Array.isArray(e[1])?e[1]:e.slice(1)],t)}},eh=class extends B{constructor(e,t){let[s]=e;super(["GEOPOS",s,...Array.isArray(e[1])?e[1]:e.slice(1)],{deserialize:e=>(function(e){let t=[];for(let s of e)s?.[0]&&s?.[1]&&t.push({lng:Number.parseFloat(s[0]),lat:Number.parseFloat(s[1])});return t})(e),...t})}},el=class extends B{constructor([e,t,s,n,i],r){let o=["GEOSEARCH",e];("FROMMEMBER"===t.type||"frommember"===t.type)&&o.push(t.type,t.member),("FROMLONLAT"===t.type||"fromlonlat"===t.type)&&o.push(t.type,t.coordinate.lon,t.coordinate.lat),("BYRADIUS"===s.type||"byradius"===s.type)&&o.push(s.type,s.radius,s.radiusType),("BYBOX"===s.type||"bybox"===s.type)&&o.push(s.type,s.rect.width,s.rect.height,s.rectType),o.push(n),i?.count&&o.push("COUNT",i.count.limit,...i.count.any?["ANY"]:[]),super([...o,...i?.withCoord?["WITHCOORD"]:[],...i?.withDist?["WITHDIST"]:[],...i?.withHash?["WITHHASH"]:[]],{deserialize:e=>i?.withCoord||i?.withDist||i?.withHash?e.map(e=>{let t=1,s={};try{s.member=JSON.parse(e[0])}catch{s.member=e[0]}return i.withDist&&(s.dist=Number.parseFloat(e[t++])),i.withHash&&(s.hash=e[t++].toString()),i.withCoord&&(s.coord={long:Number.parseFloat(e[t][0]),lat:Number.parseFloat(e[t][1])}),s}):e.map(e=>{try{return{member:JSON.parse(e)}}catch{return{member:e}}}),...r})}},ep=class extends B{constructor([e,t,s,n,i,r],o){let c=["GEOSEARCHSTORE",e,t];("FROMMEMBER"===s.type||"frommember"===s.type)&&c.push(s.type,s.member),("FROMLONLAT"===s.type||"fromlonlat"===s.type)&&c.push(s.type,s.coordinate.lon,s.coordinate.lat),("BYRADIUS"===n.type||"byradius"===n.type)&&c.push(n.type,n.radius,n.radiusType),("BYBOX"===n.type||"bybox"===n.type)&&c.push(n.type,n.rect.width,n.rect.height,n.rectType),c.push(i),r?.count&&c.push("COUNT",r.count.limit,...r.count.any?["ANY"]:[]),super([...c,...r?.storeDist?["STOREDIST"]:[]],o)}},eu=class extends B{constructor(e,t){super(["get",...e],t)}},ed=class extends B{constructor(e,t){super(["getbit",...e],t)}},em=class extends B{constructor(e,t){super(["getdel",...e],t)}},ew=class extends B{constructor(e,t){super(["getrange",...e],t)}},ef=class extends B{constructor(e,t){super(["getset",...e],t)}},ex=class extends B{constructor(e,t){super(["hdel",...e],t)}},ey=class extends B{constructor(e,t){super(["hexists",...e],t)}},eg=class extends B{constructor(e,t){super(["hget",...e],t)}},eb=class extends B{constructor(e,t){super(["hgetall",...e],{deserialize:e=>(function(e){if(0===e.length)return null;let t={};for(;e.length>=2;){let s=e.shift(),n=e.shift();try{let e=!Number.isNaN(Number(n))&&!Number.isSafeInteger(Number(n));t[s]=e?n:JSON.parse(n)}catch{t[s]=n}}return t})(e),...t})}},eO=class extends B{constructor(e,t){super(["hincrby",...e],t)}},eS=class extends B{constructor(e,t){super(["hincrbyfloat",...e],t)}},eE=class extends B{constructor([e],t){super(["hkeys",e],t)}},eR=class extends B{constructor(e,t){super(["hlen",...e],t)}},ev=class extends B{constructor([e,...t],s){super(["hmget",e,...t],{deserialize:e=>(function(e,t){if(t.every(e=>null===e))return null;let s={};for(let[n,i]of e.entries())try{s[i]=JSON.parse(t[n])}catch{s[i]=t[n]}return s})(t,e),...s})}},eA=class extends B{constructor([e,t],s){super(["hmset",e,...Object.entries(t).flatMap(([e,t])=>[e,t])],s)}},eT=class extends B{constructor([e,t,s],n){let i=["hscan",e,t];s?.match&&i.push("match",s.match),"number"==typeof s?.count&&i.push("count",s.count),super(i,{deserialize:M,...n})}},ek=class extends B{constructor([e,t],s){super(["hset",e,...Object.entries(t).flatMap(([e,t])=>[e,t])],s)}},e_=class extends B{constructor(e,t){super(["hsetnx",...e],t)}},eN=class extends B{constructor(e,t){super(["hstrlen",...e],t)}},ez=class extends B{constructor(e,t){super(["hvals",...e],t)}},eP=class extends B{constructor(e,t){super(["incr",...e],t)}},eI=class extends B{constructor(e,t){super(["incrby",...e],t)}},eU=class extends B{constructor(e,t){super(["incrbyfloat",...e],t)}},ej=class extends B{constructor(e,t){super(["JSON.ARRAPPEND",...e],t)}},eC=class extends B{constructor(e,t){super(["JSON.ARRINDEX",...e],t)}},eD=class extends B{constructor(e,t){super(["JSON.ARRINSERT",...e],t)}},eM=class extends B{constructor(e,t){super(["JSON.ARRLEN",e[0],e[1]??"$"],t)}},eL=class extends B{constructor(e,t){super(["JSON.ARRPOP",...e],t)}},eB=class extends B{constructor(e,t){let s=e[1]??"$";super(["JSON.ARRTRIM",e[0],s,e[2]??0,e[3]??0],t)}},eJ=class extends B{constructor(e,t){super(["JSON.CLEAR",...e],t)}},eH=class extends B{constructor(e,t){super(["JSON.DEL",...e],t)}},e$=class extends B{constructor(e,t){super(["JSON.FORGET",...e],t)}},eq=class extends B{constructor(e,t){let s=["JSON.GET"];"string"==typeof e[1]?s.push(...e):(s.push(e[0]),e[1]&&(e[1].indent&&s.push("INDENT",e[1].indent),e[1].newline&&s.push("NEWLINE",e[1].newline),e[1].space&&s.push("SPACE",e[1].space)),s.push(...e.slice(2))),super(s,t)}},eW=class extends B{constructor(e,t){super(["JSON.MGET",...e[0],e[1]],t)}},eY=class extends B{constructor(e,t){let s=["JSON.MSET"];for(let t of e)s.push(t.key,t.path,t.value);super(s,t)}},eF=class extends B{constructor(e,t){super(["JSON.NUMINCRBY",...e],t)}},eK=class extends B{constructor(e,t){super(["JSON.NUMMULTBY",...e],t)}},eX=class extends B{constructor(e,t){super(["JSON.OBJKEYS",...e],t)}},eV=class extends B{constructor(e,t){super(["JSON.OBJLEN",...e],t)}},eG=class extends B{constructor(e,t){super(["JSON.RESP",...e],t)}},eQ=class extends B{constructor(e,t){let s=["JSON.SET",e[0],e[1],e[2]];e[3]&&(e[3].nx?s.push("NX"):e[3].xx&&s.push("XX")),super(s,t)}},eZ=class extends B{constructor(e,t){super(["JSON.STRAPPEND",...e],t)}},e0=class extends B{constructor(e,t){super(["JSON.STRLEN",...e],t)}},e1=class extends B{constructor(e,t){super(["JSON.TOGGLE",...e],t)}},e2=class extends B{constructor(e,t){super(["JSON.TYPE",...e],t)}},e4=class extends B{constructor(e,t){super(["keys",...e],t)}},e3=class extends B{constructor(e,t){super(["lindex",...e],t)}},e5=class extends B{constructor(e,t){super(["linsert",...e],t)}},e8=class extends B{constructor(e,t){super(["llen",...e],t)}},e6=class extends B{constructor(e,t){super(["lmove",...e],t)}},e9=class extends B{constructor(e,t){let[s,n,i,r]=e;super(["LMPOP",s,...n,i,...r?["COUNT",r]:[]],t)}},e7=class extends B{constructor(e,t){super(["lpop",...e],t)}},te=class extends B{constructor(e,t){let s=["lpos",e[0],e[1]];"number"==typeof e[2]?.rank&&s.push("rank",e[2].rank),"number"==typeof e[2]?.count&&s.push("count",e[2].count),"number"==typeof e[2]?.maxLen&&s.push("maxLen",e[2].maxLen),super(s,t)}},tt=class extends B{constructor(e,t){super(["lpush",...e],t)}},ts=class extends B{constructor(e,t){super(["lpushx",...e],t)}},tn=class extends B{constructor(e,t){super(["lrange",...e],t)}},ti=class extends B{constructor(e,t){super(["lrem",...e],t)}},tr=class extends B{constructor(e,t){super(["lset",...e],t)}},to=class extends B{constructor(e,t){super(["ltrim",...e],t)}},tc=class extends B{constructor(e,t){super(["mget",...Array.isArray(e[0])?e[0]:e],t)}},ta=class extends B{constructor([e],t){super(["mset",...Object.entries(e).flatMap(([e,t])=>[e,t])],t)}},th=class extends B{constructor([e],t){super(["msetnx",...Object.entries(e).flat()],t)}},tl=class extends B{constructor(e,t){super(["persist",...e],t)}},tp=class extends B{constructor(e,t){super(["pexpire",...e],t)}},tu=class extends B{constructor(e,t){super(["pexpireat",...e],t)}},td=class extends B{constructor(e,t){super(["pfadd",...e],t)}},tm=class extends B{constructor(e,t){super(["pfcount",...e],t)}},tw=class extends B{constructor(e,t){super(["pfmerge",...e],t)}},tf=class extends B{constructor(e,t){let s=["ping"];e?.[0]!==void 0&&s.push(e[0]),super(s,t)}},tx=class extends B{constructor(e,t){super(["psetex",...e],t)}},ty=class extends B{constructor(e,t){super(["pttl",...e],t)}},tg=class extends B{constructor(e,t){super(["publish",...e],t)}},tb=class extends B{constructor(e){super(["randomkey"],e)}},tO=class extends B{constructor(e,t){super(["rename",...e],t)}},tS=class extends B{constructor(e,t){super(["renamenx",...e],t)}},tE=class extends B{constructor(e,t){super(["rpop",...e],t)}},tR=class extends B{constructor(e,t){super(["rpush",...e],t)}},tv=class extends B{constructor(e,t){super(["rpushx",...e],t)}},tA=class extends B{constructor(e,t){super(["sadd",...e],t)}},tT=class extends B{constructor([e,t],s){let n=["scan",e];t?.match&&n.push("match",t.match),"number"==typeof t?.count&&n.push("count",t.count),t?.type&&t.type.length>0&&n.push("type",t.type),super(n,{deserialize:M,...s})}},tk=class extends B{constructor(e,t){super(["scard",...e],t)}},t_=class extends B{constructor(e,t){super(["script","exists",...e],{deserialize:e=>e,...t})}},tN=class extends B{constructor([e],t){let s=["script","flush"];e?.sync?s.push("sync"):e?.async&&s.push("async"),super(s,t)}},tz=class extends B{constructor(e,t){super(["script","load",...e],t)}},tP=class extends B{constructor(e,t){super(["sdiff",...e],t)}},tI=class extends B{constructor(e,t){super(["sdiffstore",...e],t)}},tU=class extends B{constructor([e,t,s],n){let i=["set",e,t];s&&("nx"in s&&s.nx?i.push("nx"):"xx"in s&&s.xx&&i.push("xx"),"get"in s&&s.get&&i.push("get"),"ex"in s&&"number"==typeof s.ex?i.push("ex",s.ex):"px"in s&&"number"==typeof s.px?i.push("px",s.px):"exat"in s&&"number"==typeof s.exat?i.push("exat",s.exat):"pxat"in s&&"number"==typeof s.pxat?i.push("pxat",s.pxat):"keepTtl"in s&&s.keepTtl&&i.push("keepTtl")),super(i,n)}},tj=class extends B{constructor(e,t){super(["setbit",...e],t)}},tC=class extends B{constructor(e,t){super(["setex",...e],t)}},tD=class extends B{constructor(e,t){super(["setnx",...e],t)}},tM=class extends B{constructor(e,t){super(["setrange",...e],t)}},tL=class extends B{constructor(e,t){super(["sinter",...e],t)}},tB=class extends B{constructor(e,t){super(["sinterstore",...e],t)}},tJ=class extends B{constructor(e,t){super(["sismember",...e],t)}},tH=class extends B{constructor(e,t){super(["smembers",...e],t)}},t$=class extends B{constructor(e,t){super(["smismember",e[0],...e[1]],t)}},tq=class extends B{constructor(e,t){super(["smove",...e],t)}},tW=class extends B{constructor([e,t],s){let n=["spop",e];"number"==typeof t&&n.push(t),super(n,s)}},tY=class extends B{constructor([e,t],s){let n=["srandmember",e];"number"==typeof t&&n.push(t),super(n,s)}},tF=class extends B{constructor(e,t){super(["srem",...e],t)}},tK=class extends B{constructor([e,t,s],n){let i=["sscan",e,t];s?.match&&i.push("match",s.match),"number"==typeof s?.count&&i.push("count",s.count),super(i,{deserialize:M,...n})}},tX=class extends B{constructor(e,t){super(["strlen",...e],t)}},tV=class extends B{constructor(e,t){super(["sunion",...e],t)}},tG=class extends B{constructor(e,t){super(["sunionstore",...e],t)}},tQ=class extends B{constructor(e){super(["time"],e)}},tZ=class extends B{constructor(e,t){super(["touch",...e],t)}},t0=class extends B{constructor(e,t){super(["ttl",...e],t)}},t1=class extends B{constructor(e,t){super(["type",...e],t)}},t2=class extends B{constructor(e,t){super(["unlink",...e],t)}},t4=class extends B{constructor([e,t,s],n){super(["XACK",e,t,...Array.isArray(s)?[...s]:[s]],n)}},t3=class extends B{constructor([e,t,s,n],i){let r=["XADD",e];for(let[e,i]of(n&&(n.nomkStream&&r.push("NOMKSTREAM"),n.trim&&(r.push(n.trim.type,n.trim.comparison,n.trim.threshold),void 0!==n.trim.limit&&r.push("LIMIT",n.trim.limit))),r.push(t),Object.entries(s)))r.push(e,i);super(r,i)}},t5=class extends B{constructor([e,t,s,n,i,r],o){let c=[];r?.count&&c.push("COUNT",r.count),r?.justId&&c.push("JUSTID"),super(["XAUTOCLAIM",e,t,s,n,i,...c],o)}},t8=class extends B{constructor([e,t,s,n,i,r],o){let c=Array.isArray(i)?[...i]:[i],a=[];r?.idleMS&&a.push("IDLE",r.idleMS),r?.idleMS&&a.push("TIME",r.timeMS),r?.retryCount&&a.push("RETRYCOUNT",r.retryCount),r?.force&&a.push("FORCE"),r?.justId&&a.push("JUSTID"),r?.lastId&&a.push("LASTID",r.lastId),super(["XCLAIM",e,t,s,n,...c,...a],o)}},t6=class extends B{constructor([e,t],s){super(["XDEL",e,...Array.isArray(t)?[...t]:[t]],s)}},t9=class extends B{constructor([e,t],s){let n=["XGROUP"];switch(t.type){case"CREATE":n.push("CREATE",e,t.group,t.id),t.options&&(t.options.MKSTREAM&&n.push("MKSTREAM"),void 0!==t.options.ENTRIESREAD&&n.push("ENTRIESREAD",t.options.ENTRIESREAD.toString()));break;case"CREATECONSUMER":n.push("CREATECONSUMER",e,t.group,t.consumer);break;case"DELCONSUMER":n.push("DELCONSUMER",e,t.group,t.consumer);break;case"DESTROY":n.push("DESTROY",e,t.group);break;case"SETID":n.push("SETID",e,t.group,t.id),t.options?.ENTRIESREAD!==void 0&&n.push("ENTRIESREAD",t.options.ENTRIESREAD.toString());break;default:throw Error("Invalid XGROUP")}super(n,s)}},t7=class extends B{constructor([e,t],s){let n=[];"CONSUMERS"===t.type?n.push("CONSUMERS",e,t.group):n.push("GROUPS",e),super(["XINFO",...n],s)}},se=class extends B{constructor(e,t){super(["XLEN",...e],t)}},st=class extends B{constructor([e,t,s,n,i,r],o){super(["XPENDING",e,t,...r?.idleTime?["IDLE",r.idleTime]:[],s,n,i,...r?.consumer===void 0?[]:Array.isArray(r.consumer)?[...r.consumer]:[r.consumer]],o)}},ss=class extends B{constructor([e,t,s,n],i){let r=["XRANGE",e,t,s];"number"==typeof n&&r.push("COUNT",n),super(r,{deserialize:e=>(function(e){let t={};for(let s of e)for(;s.length>=2;){let e=s.shift(),n=s.shift();for((e in t)||(t[e]={});n.length>=2;){let s=n.shift(),i=n.shift();try{t[e][s]=JSON.parse(i)}catch{t[e][s]=i}}}return t})(e),...i})}},sn=class extends B{constructor([e,t,s],n){if(Array.isArray(e)&&Array.isArray(t)&&e.length!==t.length)throw Error("ERR Unbalanced XREAD list of streams: for each stream key an ID or '$' must be specified");let i=[];"number"==typeof s?.count&&i.push("COUNT",s.count),"number"==typeof s?.blockMS&&i.push("BLOCK",s.blockMS),i.push("STREAMS",...Array.isArray(e)?[...e]:[e],...Array.isArray(t)?[...t]:[t]),super(["XREAD",...i],n)}},si=class extends B{constructor([e,t,s,n,i],r){if(Array.isArray(s)&&Array.isArray(n)&&s.length!==n.length)throw Error("ERR Unbalanced XREADGROUP list of streams: for each stream key an ID or '$' must be specified");let o=[];"number"==typeof i?.count&&o.push("COUNT",i.count),"number"==typeof i?.blockMS&&o.push("BLOCK",i.blockMS),"boolean"==typeof i?.NOACK&&i.NOACK&&o.push("NOACK"),o.push("STREAMS",...Array.isArray(s)?[...s]:[s],...Array.isArray(n)?[...n]:[n]),super(["XREADGROUP","GROUP",e,t,...o],r)}},sr=class extends B{constructor([e,t,s,n],i){let r=["XREVRANGE",e,t,s];"number"==typeof n&&r.push("COUNT",n),super(r,{deserialize:e=>(function(e){let t={};for(let s of e)for(;s.length>=2;){let e=s.shift(),n=s.shift();for((e in t)||(t[e]={});n.length>=2;){let s=n.shift(),i=n.shift();try{t[e][s]=JSON.parse(i)}catch{t[e][s]=i}}}return t})(e),...i})}},so=class extends B{constructor([e,t],s){let{limit:n,strategy:i,threshold:r,exactness:o="~"}=t;super(["XTRIM",e,i,o,r,...n?["LIMIT",n]:[]],s)}},sc=class extends B{constructor([e,t,...s],n){let i=["zadd",e];"nx"in t&&t.nx?i.push("nx"):"xx"in t&&t.xx&&i.push("xx"),"ch"in t&&t.ch&&i.push("ch"),"incr"in t&&t.incr&&i.push("incr"),"lt"in t&&t.lt?i.push("lt"):"gt"in t&&t.gt&&i.push("gt"),"score"in t&&"member"in t&&i.push(t.score,t.member),i.push(...s.flatMap(({score:e,member:t})=>[e,t])),super(i,n)}},sa=class extends B{constructor(e,t){super(["zcard",...e],t)}},sh=class extends B{constructor(e,t){super(["zcount",...e],t)}},sl=class extends B{constructor(e,t){super(["zincrby",...e],t)}},sp=class extends B{constructor([e,t,s,n],i){let r=["zinterstore",e,t];Array.isArray(s)?r.push(...s):r.push(s),n&&("weights"in n&&n.weights?r.push("weights",...n.weights):"weight"in n&&"number"==typeof n.weight&&r.push("weights",n.weight),"aggregate"in n&&r.push("aggregate",n.aggregate)),super(r,i)}},su=class extends B{constructor(e,t){super(["zlexcount",...e],t)}},sd=class extends B{constructor([e,t],s){let n=["zpopmax",e];"number"==typeof t&&n.push(t),super(n,s)}},sm=class extends B{constructor([e,t],s){let n=["zpopmin",e];"number"==typeof t&&n.push(t),super(n,s)}},sw=class extends B{constructor([e,t,s,n],i){let r=["zrange",e,t,s];n?.byScore&&r.push("byscore"),n?.byLex&&r.push("bylex"),n?.rev&&r.push("rev"),n?.count!==void 0&&void 0!==n.offset&&r.push("limit",n.offset,n.count),n?.withScores&&r.push("withscores"),super(r,i)}},sf=class extends B{constructor(e,t){super(["zrank",...e],t)}},sx=class extends B{constructor(e,t){super(["zrem",...e],t)}},sy=class extends B{constructor(e,t){super(["zremrangebylex",...e],t)}},sg=class extends B{constructor(e,t){super(["zremrangebyrank",...e],t)}},sb=class extends B{constructor(e,t){super(["zremrangebyscore",...e],t)}},sO=class extends B{constructor(e,t){super(["zrevrank",...e],t)}},sS=class extends B{constructor([e,t,s],n){let i=["zscan",e,t];s?.match&&i.push("match",s.match),"number"==typeof s?.count&&i.push("count",s.count),super(i,{deserialize:M,...n})}},sE=class extends B{constructor(e,t){super(["zscore",...e],t)}},sR=class extends B{constructor([e,t,s],n){let i=["zunion",e];Array.isArray(t)?i.push(...t):i.push(t),s&&("weights"in s&&s.weights?i.push("weights",...s.weights):"weight"in s&&"number"==typeof s.weight&&i.push("weights",s.weight),"aggregate"in s&&i.push("aggregate",s.aggregate),s.withScores&&i.push("withscores")),super(i,n)}},sv=class extends B{constructor([e,t,s,n],i){let r=["zunionstore",e,t];Array.isArray(s)?r.push(...s):r.push(s),n&&("weights"in n&&n.weights?r.push("weights",...n.weights):"weight"in n&&"number"==typeof n.weight&&r.push("weights",n.weight),"aggregate"in n&&r.push("aggregate",n.aggregate)),super(r,i)}},sA=class extends B{constructor(e,t){super(["zdiffstore",...e],t)}},sT=class extends B{constructor(e,t){let[s,n]=e;super(["zmscore",s,...n],t)}},sk=class{client;commands;commandOptions;multiExec;constructor(e){if(this.client=e.client,this.commands=[],this.commandOptions=e.commandOptions,this.multiExec=e.multiExec??!1,this.commandOptions?.latencyLogging){let e=this.exec.bind(this);this.exec=async t=>{let s=performance.now(),n=await (t?e(t):e()),i=(performance.now()-s).toFixed(2);return console.log(`Latency for \x1b[38;2;19;185;39m${this.multiExec?["MULTI-EXEC"]:["PIPELINE"].toString().toUpperCase()}\x1b[0m: \x1b[38;2;0;255;255m${i} ms\x1b[0m`),n}}}exec=async e=>{if(0===this.commands.length)throw Error("Pipeline is empty");let t=this.multiExec?["multi-exec"]:["pipeline"],s=await this.client.request({path:t,body:Object.values(this.commands).map(e=>e.command)});return e?.keepErrors?s.map(({error:e,result:t},s)=>({error:e,result:this.commands[s].deserialize(t)})):s.map(({error:e,result:t},s)=>{if(e)throw new z(`Command ${s+1} [ ${this.commands[s].command[0]} ] failed: ${e}`);return this.commands[s].deserialize(t)})};length(){return this.commands.length}chain(e){return this.commands.push(e),this}append=(...e)=>this.chain(new H(e,this.commandOptions));bitcount=(...e)=>this.chain(new $(e,this.commandOptions));bitfield=(...e)=>new q(e,this.client,this.commandOptions,this.chain.bind(this));bitop=(e,t,s,...n)=>this.chain(new W([e,t,s,...n],this.commandOptions));bitpos=(...e)=>this.chain(new Y(e,this.commandOptions));copy=(...e)=>this.chain(new F(e,this.commandOptions));zdiffstore=(...e)=>this.chain(new sA(e,this.commandOptions));dbsize=()=>this.chain(new K(this.commandOptions));decr=(...e)=>this.chain(new X(e,this.commandOptions));decrby=(...e)=>this.chain(new V(e,this.commandOptions));del=(...e)=>this.chain(new G(e,this.commandOptions));echo=(...e)=>this.chain(new Q(e,this.commandOptions));eval=(...e)=>this.chain(new Z(e,this.commandOptions));evalsha=(...e)=>this.chain(new ee(e,this.commandOptions));exists=(...e)=>this.chain(new et(e,this.commandOptions));expire=(...e)=>this.chain(new es(e,this.commandOptions));expireat=(...e)=>this.chain(new en(e,this.commandOptions));flushall=e=>this.chain(new ei(e,this.commandOptions));flushdb=(...e)=>this.chain(new er(e,this.commandOptions));geoadd=(...e)=>this.chain(new eo(e,this.commandOptions));geodist=(...e)=>this.chain(new ec(e,this.commandOptions));geopos=(...e)=>this.chain(new eh(e,this.commandOptions));geohash=(...e)=>this.chain(new ea(e,this.commandOptions));geosearch=(...e)=>this.chain(new el(e,this.commandOptions));geosearchstore=(...e)=>this.chain(new ep(e,this.commandOptions));get=(...e)=>this.chain(new eu(e,this.commandOptions));getbit=(...e)=>this.chain(new ed(e,this.commandOptions));getdel=(...e)=>this.chain(new em(e,this.commandOptions));getrange=(...e)=>this.chain(new ew(e,this.commandOptions));getset=(e,t)=>this.chain(new ef([e,t],this.commandOptions));hdel=(...e)=>this.chain(new ex(e,this.commandOptions));hexists=(...e)=>this.chain(new ey(e,this.commandOptions));hget=(...e)=>this.chain(new eg(e,this.commandOptions));hgetall=(...e)=>this.chain(new eb(e,this.commandOptions));hincrby=(...e)=>this.chain(new eO(e,this.commandOptions));hincrbyfloat=(...e)=>this.chain(new eS(e,this.commandOptions));hkeys=(...e)=>this.chain(new eE(e,this.commandOptions));hlen=(...e)=>this.chain(new eR(e,this.commandOptions));hmget=(...e)=>this.chain(new ev(e,this.commandOptions));hmset=(e,t)=>this.chain(new eA([e,t],this.commandOptions));hrandfield=(e,t,s)=>this.chain(new J([e,t,s],this.commandOptions));hscan=(...e)=>this.chain(new eT(e,this.commandOptions));hset=(e,t)=>this.chain(new ek([e,t],this.commandOptions));hsetnx=(e,t,s)=>this.chain(new e_([e,t,s],this.commandOptions));hstrlen=(...e)=>this.chain(new eN(e,this.commandOptions));hvals=(...e)=>this.chain(new ez(e,this.commandOptions));incr=(...e)=>this.chain(new eP(e,this.commandOptions));incrby=(...e)=>this.chain(new eI(e,this.commandOptions));incrbyfloat=(...e)=>this.chain(new eU(e,this.commandOptions));keys=(...e)=>this.chain(new e4(e,this.commandOptions));lindex=(...e)=>this.chain(new e3(e,this.commandOptions));linsert=(e,t,s,n)=>this.chain(new e5([e,t,s,n],this.commandOptions));llen=(...e)=>this.chain(new e8(e,this.commandOptions));lmove=(...e)=>this.chain(new e6(e,this.commandOptions));lpop=(...e)=>this.chain(new e7(e,this.commandOptions));lmpop=(...e)=>this.chain(new e9(e,this.commandOptions));lpos=(...e)=>this.chain(new te(e,this.commandOptions));lpush=(e,...t)=>this.chain(new tt([e,...t],this.commandOptions));lpushx=(e,...t)=>this.chain(new ts([e,...t],this.commandOptions));lrange=(...e)=>this.chain(new tn(e,this.commandOptions));lrem=(e,t,s)=>this.chain(new ti([e,t,s],this.commandOptions));lset=(e,t,s)=>this.chain(new tr([e,t,s],this.commandOptions));ltrim=(...e)=>this.chain(new to(e,this.commandOptions));mget=(...e)=>this.chain(new tc(e,this.commandOptions));mset=e=>this.chain(new ta([e],this.commandOptions));msetnx=e=>this.chain(new th([e],this.commandOptions));persist=(...e)=>this.chain(new tl(e,this.commandOptions));pexpire=(...e)=>this.chain(new tp(e,this.commandOptions));pexpireat=(...e)=>this.chain(new tu(e,this.commandOptions));pfadd=(...e)=>this.chain(new td(e,this.commandOptions));pfcount=(...e)=>this.chain(new tm(e,this.commandOptions));pfmerge=(...e)=>this.chain(new tw(e,this.commandOptions));ping=e=>this.chain(new tf(e,this.commandOptions));psetex=(e,t,s)=>this.chain(new tx([e,t,s],this.commandOptions));pttl=(...e)=>this.chain(new ty(e,this.commandOptions));publish=(...e)=>this.chain(new tg(e,this.commandOptions));randomkey=()=>this.chain(new tb(this.commandOptions));rename=(...e)=>this.chain(new tO(e,this.commandOptions));renamenx=(...e)=>this.chain(new tS(e,this.commandOptions));rpop=(...e)=>this.chain(new tE(e,this.commandOptions));rpush=(e,...t)=>this.chain(new tR([e,...t],this.commandOptions));rpushx=(e,...t)=>this.chain(new tv([e,...t],this.commandOptions));sadd=(e,t,...s)=>this.chain(new tA([e,t,...s],this.commandOptions));scan=(...e)=>this.chain(new tT(e,this.commandOptions));scard=(...e)=>this.chain(new tk(e,this.commandOptions));scriptExists=(...e)=>this.chain(new t_(e,this.commandOptions));scriptFlush=(...e)=>this.chain(new tN(e,this.commandOptions));scriptLoad=(...e)=>this.chain(new tz(e,this.commandOptions));sdiff=(...e)=>this.chain(new tP(e,this.commandOptions));sdiffstore=(...e)=>this.chain(new tI(e,this.commandOptions));set=(e,t,s)=>this.chain(new tU([e,t,s],this.commandOptions));setbit=(...e)=>this.chain(new tj(e,this.commandOptions));setex=(e,t,s)=>this.chain(new tC([e,t,s],this.commandOptions));setnx=(e,t)=>this.chain(new tD([e,t],this.commandOptions));setrange=(...e)=>this.chain(new tM(e,this.commandOptions));sinter=(...e)=>this.chain(new tL(e,this.commandOptions));sinterstore=(...e)=>this.chain(new tB(e,this.commandOptions));sismember=(e,t)=>this.chain(new tJ([e,t],this.commandOptions));smembers=(...e)=>this.chain(new tH(e,this.commandOptions));smismember=(e,t)=>this.chain(new t$([e,t],this.commandOptions));smove=(e,t,s)=>this.chain(new tq([e,t,s],this.commandOptions));spop=(...e)=>this.chain(new tW(e,this.commandOptions));srandmember=(...e)=>this.chain(new tY(e,this.commandOptions));srem=(e,...t)=>this.chain(new tF([e,...t],this.commandOptions));sscan=(...e)=>this.chain(new tK(e,this.commandOptions));strlen=(...e)=>this.chain(new tX(e,this.commandOptions));sunion=(...e)=>this.chain(new tV(e,this.commandOptions));sunionstore=(...e)=>this.chain(new tG(e,this.commandOptions));time=()=>this.chain(new tQ(this.commandOptions));touch=(...e)=>this.chain(new tZ(e,this.commandOptions));ttl=(...e)=>this.chain(new t0(e,this.commandOptions));type=(...e)=>this.chain(new t1(e,this.commandOptions));unlink=(...e)=>this.chain(new t2(e,this.commandOptions));zadd=(...e)=>(e[1],this.chain(new sc([e[0],e[1],...e.slice(2)],this.commandOptions)));xadd=(...e)=>this.chain(new t3(e,this.commandOptions));xack=(...e)=>this.chain(new t4(e,this.commandOptions));xdel=(...e)=>this.chain(new t6(e,this.commandOptions));xgroup=(...e)=>this.chain(new t9(e,this.commandOptions));xread=(...e)=>this.chain(new sn(e,this.commandOptions));xreadgroup=(...e)=>this.chain(new si(e,this.commandOptions));xinfo=(...e)=>this.chain(new t7(e,this.commandOptions));xlen=(...e)=>this.chain(new se(e,this.commandOptions));xpending=(...e)=>this.chain(new st(e,this.commandOptions));xclaim=(...e)=>this.chain(new t8(e,this.commandOptions));xautoclaim=(...e)=>this.chain(new t5(e,this.commandOptions));xtrim=(...e)=>this.chain(new so(e,this.commandOptions));xrange=(...e)=>this.chain(new ss(e,this.commandOptions));xrevrange=(...e)=>this.chain(new sr(e,this.commandOptions));zcard=(...e)=>this.chain(new sa(e,this.commandOptions));zcount=(...e)=>this.chain(new sh(e,this.commandOptions));zincrby=(e,t,s)=>this.chain(new sl([e,t,s],this.commandOptions));zinterstore=(...e)=>this.chain(new sp(e,this.commandOptions));zlexcount=(...e)=>this.chain(new su(e,this.commandOptions));zmscore=(...e)=>this.chain(new sT(e,this.commandOptions));zpopmax=(...e)=>this.chain(new sd(e,this.commandOptions));zpopmin=(...e)=>this.chain(new sm(e,this.commandOptions));zrange=(...e)=>this.chain(new sw(e,this.commandOptions));zrank=(e,t)=>this.chain(new sf([e,t],this.commandOptions));zrem=(e,...t)=>this.chain(new sx([e,...t],this.commandOptions));zremrangebylex=(...e)=>this.chain(new sy(e,this.commandOptions));zremrangebyrank=(...e)=>this.chain(new sg(e,this.commandOptions));zremrangebyscore=(...e)=>this.chain(new sb(e,this.commandOptions));zrevrank=(e,t)=>this.chain(new sO([e,t],this.commandOptions));zscan=(...e)=>this.chain(new sS(e,this.commandOptions));zscore=(e,t)=>this.chain(new sE([e,t],this.commandOptions));zunionstore=(...e)=>this.chain(new sv(e,this.commandOptions));zunion=(...e)=>this.chain(new sR(e,this.commandOptions));get json(){return{arrappend:(...e)=>this.chain(new ej(e,this.commandOptions)),arrindex:(...e)=>this.chain(new eC(e,this.commandOptions)),arrinsert:(...e)=>this.chain(new eD(e,this.commandOptions)),arrlen:(...e)=>this.chain(new eM(e,this.commandOptions)),arrpop:(...e)=>this.chain(new eL(e,this.commandOptions)),arrtrim:(...e)=>this.chain(new eB(e,this.commandOptions)),clear:(...e)=>this.chain(new eJ(e,this.commandOptions)),del:(...e)=>this.chain(new eH(e,this.commandOptions)),forget:(...e)=>this.chain(new e$(e,this.commandOptions)),get:(...e)=>this.chain(new eq(e,this.commandOptions)),mget:(...e)=>this.chain(new eW(e,this.commandOptions)),mset:(...e)=>this.chain(new eY(e,this.commandOptions)),numincrby:(...e)=>this.chain(new eF(e,this.commandOptions)),nummultby:(...e)=>this.chain(new eK(e,this.commandOptions)),objkeys:(...e)=>this.chain(new eX(e,this.commandOptions)),objlen:(...e)=>this.chain(new eV(e,this.commandOptions)),resp:(...e)=>this.chain(new eG(e,this.commandOptions)),set:(...e)=>this.chain(new eQ(e,this.commandOptions)),strappend:(...e)=>this.chain(new eZ(e,this.commandOptions)),strlen:(...e)=>this.chain(new e0(e,this.commandOptions)),toggle:(...e)=>this.chain(new e1(e,this.commandOptions)),type:(...e)=>this.chain(new e2(e,this.commandOptions))}}},s_=class{pipelinePromises=new WeakMap;activePipeline=null;indexInCurrentPipeline=0;redis;pipeline;pipelineCounter=0;constructor(e){this.redis=e,this.pipeline=e.pipeline()}async withAutoPipeline(e){let t=this.activePipeline??this.redis.pipeline();this.activePipeline||(this.activePipeline=t,this.indexInCurrentPipeline=0);let s=this.indexInCurrentPipeline++;e(t);let n=this.deferExecution().then(()=>{if(!this.pipelinePromises.has(t)){let e=t.exec({keepErrors:!0});this.pipelineCounter+=1,this.pipelinePromises.set(t,e),this.activePipeline=null}return this.pipelinePromises.get(t)}),i=(await n)[s];if(i.error)throw new z(`Command failed: ${i.error}`);return i.result}async deferExecution(){await Promise.resolve(),await Promise.resolve()}},sN=class{script;sha1;redis;constructor(e,t){this.redis=e,this.sha1=this.digest(t),this.script=t}async eval(e,t){return await this.redis.eval(this.script,e,t)}async evalsha(e,t){return await this.redis.evalsha(this.sha1,e,t)}async exec(e,t){return await this.redis.evalsha(this.sha1,e,t).catch(async s=>{if(s instanceof Error&&s.message.toLowerCase().includes("noscript"))return await this.redis.eval(this.script,e,t);throw s})}digest(e){return k.default.stringify((0,_.default)(e))}},sz=class{client;opts;enableTelemetry;enableAutoPipelining;constructor(e,t){this.client=e,this.opts=t,this.enableTelemetry=t?.enableTelemetry??!0,t?.readYourWrites===!1&&(this.client.readYourWrites=!1),this.enableAutoPipelining=t?.enableAutoPipelining??!0}get readYourWritesSyncToken(){return this.client.upstashSyncToken}set readYourWritesSyncToken(e){this.client.upstashSyncToken=e}get json(){return{arrappend:(...e)=>new ej(e,this.opts).exec(this.client),arrindex:(...e)=>new eC(e,this.opts).exec(this.client),arrinsert:(...e)=>new eD(e,this.opts).exec(this.client),arrlen:(...e)=>new eM(e,this.opts).exec(this.client),arrpop:(...e)=>new eL(e,this.opts).exec(this.client),arrtrim:(...e)=>new eB(e,this.opts).exec(this.client),clear:(...e)=>new eJ(e,this.opts).exec(this.client),del:(...e)=>new eH(e,this.opts).exec(this.client),forget:(...e)=>new e$(e,this.opts).exec(this.client),get:(...e)=>new eq(e,this.opts).exec(this.client),mget:(...e)=>new eW(e,this.opts).exec(this.client),mset:(...e)=>new eY(e,this.opts).exec(this.client),numincrby:(...e)=>new eF(e,this.opts).exec(this.client),nummultby:(...e)=>new eK(e,this.opts).exec(this.client),objkeys:(...e)=>new eX(e,this.opts).exec(this.client),objlen:(...e)=>new eV(e,this.opts).exec(this.client),resp:(...e)=>new eG(e,this.opts).exec(this.client),set:(...e)=>new eQ(e,this.opts).exec(this.client),strappend:(...e)=>new eZ(e,this.opts).exec(this.client),strlen:(...e)=>new e0(e,this.opts).exec(this.client),toggle:(...e)=>new e1(e,this.opts).exec(this.client),type:(...e)=>new e2(e,this.opts).exec(this.client)}}use=e=>{let t=this.client.request.bind(this.client);this.client.request=s=>e(s,t)};addTelemetry=e=>{if(this.enableTelemetry)try{this.client.mergeTelemetry(e)}catch{}};createScript(e){return new sN(this,e)}pipeline=()=>new sk({client:this.client,commandOptions:this.opts,multiExec:!1});autoPipeline=()=>(function e(t,s){return t.autoPipelineExecutor||(t.autoPipelineExecutor=new s_(t)),new Proxy(t,{get:(t,n)=>"pipelineCounter"===n?t.autoPipelineExecutor.pipelineCounter:"json"===n?e(t,!0):n in t&&!(n in t.autoPipelineExecutor.pipeline)?t[n]:(s?"function"==typeof t.autoPipelineExecutor.pipeline.json[n]:"function"==typeof t.autoPipelineExecutor.pipeline[n])?(...e)=>t.autoPipelineExecutor.withAutoPipeline(t=>{s?t.json[n](...e):t[n](...e)}):t.autoPipelineExecutor.pipeline[n]})})(this);multi=()=>new sk({client:this.client,commandOptions:this.opts,multiExec:!0});bitfield=(...e)=>new q(e,this.client,this.opts);append=(...e)=>new H(e,this.opts).exec(this.client);bitcount=(...e)=>new $(e,this.opts).exec(this.client);bitop=(e,t,s,...n)=>new W([e,t,s,...n],this.opts).exec(this.client);bitpos=(...e)=>new Y(e,this.opts).exec(this.client);copy=(...e)=>new F(e,this.opts).exec(this.client);dbsize=()=>new K(this.opts).exec(this.client);decr=(...e)=>new X(e,this.opts).exec(this.client);decrby=(...e)=>new V(e,this.opts).exec(this.client);del=(...e)=>new G(e,this.opts).exec(this.client);echo=(...e)=>new Q(e,this.opts).exec(this.client);eval=(...e)=>new Z(e,this.opts).exec(this.client);evalsha=(...e)=>new ee(e,this.opts).exec(this.client);exists=(...e)=>new et(e,this.opts).exec(this.client);expire=(...e)=>new es(e,this.opts).exec(this.client);expireat=(...e)=>new en(e,this.opts).exec(this.client);flushall=e=>new ei(e,this.opts).exec(this.client);flushdb=(...e)=>new er(e,this.opts).exec(this.client);geoadd=(...e)=>new eo(e,this.opts).exec(this.client);geopos=(...e)=>new eh(e,this.opts).exec(this.client);geodist=(...e)=>new ec(e,this.opts).exec(this.client);geohash=(...e)=>new ea(e,this.opts).exec(this.client);geosearch=(...e)=>new el(e,this.opts).exec(this.client);geosearchstore=(...e)=>new ep(e,this.opts).exec(this.client);get=(...e)=>new eu(e,this.opts).exec(this.client);getbit=(...e)=>new ed(e,this.opts).exec(this.client);getdel=(...e)=>new em(e,this.opts).exec(this.client);getrange=(...e)=>new ew(e,this.opts).exec(this.client);getset=(e,t)=>new ef([e,t],this.opts).exec(this.client);hdel=(...e)=>new ex(e,this.opts).exec(this.client);hexists=(...e)=>new ey(e,this.opts).exec(this.client);hget=(...e)=>new eg(e,this.opts).exec(this.client);hgetall=(...e)=>new eb(e,this.opts).exec(this.client);hincrby=(...e)=>new eO(e,this.opts).exec(this.client);hincrbyfloat=(...e)=>new eS(e,this.opts).exec(this.client);hkeys=(...e)=>new eE(e,this.opts).exec(this.client);hlen=(...e)=>new eR(e,this.opts).exec(this.client);hmget=(...e)=>new ev(e,this.opts).exec(this.client);hmset=(e,t)=>new eA([e,t],this.opts).exec(this.client);hrandfield=(e,t,s)=>new J([e,t,s],this.opts).exec(this.client);hscan=(...e)=>new eT(e,this.opts).exec(this.client);hset=(e,t)=>new ek([e,t],this.opts).exec(this.client);hsetnx=(e,t,s)=>new e_([e,t,s],this.opts).exec(this.client);hstrlen=(...e)=>new eN(e,this.opts).exec(this.client);hvals=(...e)=>new ez(e,this.opts).exec(this.client);incr=(...e)=>new eP(e,this.opts).exec(this.client);incrby=(...e)=>new eI(e,this.opts).exec(this.client);incrbyfloat=(...e)=>new eU(e,this.opts).exec(this.client);keys=(...e)=>new e4(e,this.opts).exec(this.client);lindex=(...e)=>new e3(e,this.opts).exec(this.client);linsert=(e,t,s,n)=>new e5([e,t,s,n],this.opts).exec(this.client);llen=(...e)=>new e8(e,this.opts).exec(this.client);lmove=(...e)=>new e6(e,this.opts).exec(this.client);lpop=(...e)=>new e7(e,this.opts).exec(this.client);lmpop=(...e)=>new e9(e,this.opts).exec(this.client);lpos=(...e)=>new te(e,this.opts).exec(this.client);lpush=(e,...t)=>new tt([e,...t],this.opts).exec(this.client);lpushx=(e,...t)=>new ts([e,...t],this.opts).exec(this.client);lrange=(...e)=>new tn(e,this.opts).exec(this.client);lrem=(e,t,s)=>new ti([e,t,s],this.opts).exec(this.client);lset=(e,t,s)=>new tr([e,t,s],this.opts).exec(this.client);ltrim=(...e)=>new to(e,this.opts).exec(this.client);mget=(...e)=>new tc(e,this.opts).exec(this.client);mset=e=>new ta([e],this.opts).exec(this.client);msetnx=e=>new th([e],this.opts).exec(this.client);persist=(...e)=>new tl(e,this.opts).exec(this.client);pexpire=(...e)=>new tp(e,this.opts).exec(this.client);pexpireat=(...e)=>new tu(e,this.opts).exec(this.client);pfadd=(...e)=>new td(e,this.opts).exec(this.client);pfcount=(...e)=>new tm(e,this.opts).exec(this.client);pfmerge=(...e)=>new tw(e,this.opts).exec(this.client);ping=e=>new tf(e,this.opts).exec(this.client);psetex=(e,t,s)=>new tx([e,t,s],this.opts).exec(this.client);pttl=(...e)=>new ty(e,this.opts).exec(this.client);publish=(...e)=>new tg(e,this.opts).exec(this.client);randomkey=()=>new tb().exec(this.client);rename=(...e)=>new tO(e,this.opts).exec(this.client);renamenx=(...e)=>new tS(e,this.opts).exec(this.client);rpop=(...e)=>new tE(e,this.opts).exec(this.client);rpush=(e,...t)=>new tR([e,...t],this.opts).exec(this.client);rpushx=(e,...t)=>new tv([e,...t],this.opts).exec(this.client);sadd=(e,t,...s)=>new tA([e,t,...s],this.opts).exec(this.client);scan=(...e)=>new tT(e,this.opts).exec(this.client);scard=(...e)=>new tk(e,this.opts).exec(this.client);scriptExists=(...e)=>new t_(e,this.opts).exec(this.client);scriptFlush=(...e)=>new tN(e,this.opts).exec(this.client);scriptLoad=(...e)=>new tz(e,this.opts).exec(this.client);sdiff=(...e)=>new tP(e,this.opts).exec(this.client);sdiffstore=(...e)=>new tI(e,this.opts).exec(this.client);set=(e,t,s)=>new tU([e,t,s],this.opts).exec(this.client);setbit=(...e)=>new tj(e,this.opts).exec(this.client);setex=(e,t,s)=>new tC([e,t,s],this.opts).exec(this.client);setnx=(e,t)=>new tD([e,t],this.opts).exec(this.client);setrange=(...e)=>new tM(e,this.opts).exec(this.client);sinter=(...e)=>new tL(e,this.opts).exec(this.client);sinterstore=(...e)=>new tB(e,this.opts).exec(this.client);sismember=(e,t)=>new tJ([e,t],this.opts).exec(this.client);smismember=(e,t)=>new t$([e,t],this.opts).exec(this.client);smembers=(...e)=>new tH(e,this.opts).exec(this.client);smove=(e,t,s)=>new tq([e,t,s],this.opts).exec(this.client);spop=(...e)=>new tW(e,this.opts).exec(this.client);srandmember=(...e)=>new tY(e,this.opts).exec(this.client);srem=(e,...t)=>new tF([e,...t],this.opts).exec(this.client);sscan=(...e)=>new tK(e,this.opts).exec(this.client);strlen=(...e)=>new tX(e,this.opts).exec(this.client);sunion=(...e)=>new tV(e,this.opts).exec(this.client);sunionstore=(...e)=>new tG(e,this.opts).exec(this.client);time=()=>new tQ().exec(this.client);touch=(...e)=>new tZ(e,this.opts).exec(this.client);ttl=(...e)=>new t0(e,this.opts).exec(this.client);type=(...e)=>new t1(e,this.opts).exec(this.client);unlink=(...e)=>new t2(e,this.opts).exec(this.client);xadd=(...e)=>new t3(e,this.opts).exec(this.client);xack=(...e)=>new t4(e,this.opts).exec(this.client);xdel=(...e)=>new t6(e,this.opts).exec(this.client);xgroup=(...e)=>new t9(e,this.opts).exec(this.client);xread=(...e)=>new sn(e,this.opts).exec(this.client);xreadgroup=(...e)=>new si(e,this.opts).exec(this.client);xinfo=(...e)=>new t7(e,this.opts).exec(this.client);xlen=(...e)=>new se(e,this.opts).exec(this.client);xpending=(...e)=>new st(e,this.opts).exec(this.client);xclaim=(...e)=>new t8(e,this.opts).exec(this.client);xautoclaim=(...e)=>new t5(e,this.opts).exec(this.client);xtrim=(...e)=>new so(e,this.opts).exec(this.client);xrange=(...e)=>new ss(e,this.opts).exec(this.client);xrevrange=(...e)=>new sr(e,this.opts).exec(this.client);zadd=(...e)=>(e[1],new sc([e[0],e[1],...e.slice(2)],this.opts).exec(this.client));zcard=(...e)=>new sa(e,this.opts).exec(this.client);zcount=(...e)=>new sh(e,this.opts).exec(this.client);zdiffstore=(...e)=>new sA(e,this.opts).exec(this.client);zincrby=(e,t,s)=>new sl([e,t,s],this.opts).exec(this.client);zinterstore=(...e)=>new sp(e,this.opts).exec(this.client);zlexcount=(...e)=>new su(e,this.opts).exec(this.client);zmscore=(...e)=>new sT(e,this.opts).exec(this.client);zpopmax=(...e)=>new sd(e,this.opts).exec(this.client);zpopmin=(...e)=>new sm(e,this.opts).exec(this.client);zrange=(...e)=>new sw(e,this.opts).exec(this.client);zrank=(e,t)=>new sf([e,t],this.opts).exec(this.client);zrem=(e,...t)=>new sx([e,...t],this.opts).exec(this.client);zremrangebylex=(...e)=>new sy(e,this.opts).exec(this.client);zremrangebyrank=(...e)=>new sg(e,this.opts).exec(this.client);zremrangebyscore=(...e)=>new sb(e,this.opts).exec(this.client);zrevrank=(e,t)=>new sO([e,t],this.opts).exec(this.client);zscan=(...e)=>new sS(e,this.opts).exec(this.client);zscore=(e,t)=>new sE([e,t],this.opts).exec(this.client);zunion=(...e)=>new sR(e,this.opts).exec(this.client);zunionstore=(...e)=>new sv(e,this.opts).exec(this.client)},sP=class e extends sz{constructor(e,t){if(e.url?(e.url.startsWith(" ")||e.url.endsWith(" ")||/\r|\n/.test(e.url))&&console.warn("[Upstash Redis] The redis url contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'url' property is missing or undefined in your Redis config."),e.token?(e.token.startsWith(" ")||e.token.endsWith(" ")||/\r|\n/.test(e.token))&&console.warn("[Upstash Redis] The redis token contains whitespace or newline, which can cause errors!"):console.warn("[Upstash Redis] The 'token' property is missing or undefined in your Redis config."),super(new I({retry:e.retry,baseUrl:e.url,headers:{authorization:`Bearer ${e.token}`},responseEncoding:e.responseEncoding,signal:e.signal,keepAlive:e.keepAlive,readYourWrites:e.readYourWrites}),{enableTelemetry:!t?.UPSTASH_DISABLE_TELEMETRY,automaticDeserialization:e.automaticDeserialization,latencyLogging:e.latencyLogging,enableAutoPipelining:e.enableAutoPipelining}),this.addTelemetry({platform:"cloudflare",sdk:"@upstash/redis@v1.34.3"}),this.enableAutoPipelining)return this.autoPipeline()}static fromEnv(t,s){let n=t?.UPSTASH_REDIS_REST_URL??UPSTASH_REDIS_REST_URL,i=t?.UPSTASH_REDIS_REST_TOKEN??UPSTASH_REDIS_REST_TOKEN;return n||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_URL`. Please add it via `wrangler secret put UPSTASH_REDIS_REST_URL`"),i||console.warn("[Upstash Redis] Unable to find environment variable: `UPSTASH_REDIS_REST_TOKEN`. Please add it via `wrangler secret put UPSTASH_REDIS_REST_TOKEN`"),new e({...s,url:n,token:i},t)}},sI=class{targetRoom=null;redis;constructor(e,t){this.redis=new sP({token:t,url:e})}async emit(e,t){this.targetRoom&&await this.redis.publish(this.targetRoom,[e,t]),d.vF.success(`IO emitted to room "${this.targetRoom}":`,[e,t]),this.targetRoom=null}to(e){return this.targetRoom=e,this}},sU=class{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,t){this.keyToValue.set(e,t),this.valueToKey.set(t,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}},sj=class{constructor(e){this.generateIdentifier=e,this.kv=new sU}register(e,t){!this.kv.getByValue(e)&&(t||(t=this.generateIdentifier(e)),this.kv.set(t,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}},sC=class extends sj{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,t){"object"==typeof t?(t.allowProps&&this.classToAllowedProps.set(e,t.allowProps),super.register(e,t.identifier)):super.register(e,t)}getAllowedProps(e){return this.classToAllowedProps.get(e)}};function sD(e,t){Object.entries(e).forEach(([e,s])=>t(s,e))}function sM(e,t){return -1!==e.indexOf(t)}function sL(e,t){for(let s=0;s<e.length;s++){let n=e[s];if(t(n))return n}}var sB=class{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return function(e,t){let s=function(e){if("values"in Object)return Object.values(e);let t=[];for(let s in e)e.hasOwnProperty(s)&&t.push(e[s]);return t}(e);if("find"in s)return s.find(t);for(let e=0;e<s.length;e++){let n=s[e];if(t(n))return n}}(this.transfomers,t=>t.isApplicable(e))}findByName(e){return this.transfomers[e]}},sJ=e=>Object.prototype.toString.call(e).slice(8,-1),sH=e=>void 0===e,s$=e=>null===e,sq=e=>"object"==typeof e&&null!==e&&e!==Object.prototype&&(null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===Object.prototype),sW=e=>sq(e)&&0===Object.keys(e).length,sY=e=>Array.isArray(e),sF=e=>"string"==typeof e,sK=e=>"number"==typeof e&&!isNaN(e),sX=e=>"boolean"==typeof e,sV=e=>e instanceof Map,sG=e=>e instanceof Set,sQ=e=>"Symbol"===sJ(e),sZ=e=>"number"==typeof e&&isNaN(e),s0=e=>sX(e)||s$(e)||sH(e)||sK(e)||sF(e)||sQ(e),s1=e=>e===1/0||e===-1/0,s2=e=>e.replace(/\./g,"\\."),s4=e=>e.map(String).map(s2).join("."),s3=e=>{let t=[],s="";for(let n=0;n<e.length;n++){let i=e.charAt(n);if("\\"===i&&"."===e.charAt(n+1)){s+=".",n++;continue}if("."===i){t.push(s),s="";continue}s+=i}let n=s;return t.push(n),t};function s5(e,t,s,n){return{isApplicable:e,annotation:t,transform:s,untransform:n}}var s8=[s5(sH,"undefined",()=>null,()=>void 0),s5(e=>"bigint"==typeof e,"bigint",e=>e.toString(),e=>"undefined"!=typeof BigInt?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),s5(e=>e instanceof Date&&!isNaN(e.valueOf()),"Date",e=>e.toISOString(),e=>new Date(e)),s5(e=>e instanceof Error,"Error",(e,t)=>{let s={name:e.name,message:e.message};return t.allowedErrorProps.forEach(t=>{s[t]=e[t]}),s},(e,t)=>{let s=Error(e.message);return s.name=e.name,s.stack=e.stack,t.allowedErrorProps.forEach(t=>{s[t]=e[t]}),s}),s5(e=>e instanceof RegExp,"regexp",e=>""+e,e=>new RegExp(e.slice(1,e.lastIndexOf("/")),e.slice(e.lastIndexOf("/")+1))),s5(sG,"set",e=>[...e.values()],e=>new Set(e)),s5(sV,"map",e=>[...e.entries()],e=>new Map(e)),s5(e=>sZ(e)||s1(e),"number",e=>sZ(e)?"NaN":e>0?"Infinity":"-Infinity",Number),s5(e=>0===e&&1/e==-1/0,"number",()=>"-0",Number),s5(e=>e instanceof URL,"URL",e=>e.toString(),e=>new URL(e))];function s6(e,t,s,n){return{isApplicable:e,annotation:t,transform:s,untransform:n}}var s9=s6((e,t)=>!!sQ(e)&&!!t.symbolRegistry.getIdentifier(e),(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,s)=>{let n=s.symbolRegistry.getValue(t[1]);if(!n)throw Error("Trying to deserialize unknown symbol");return n}),s7=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),ne=s6(e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{let s=s7[t[1]];if(!s)throw Error("Trying to deserialize unknown typed array");return new s(e)});function nt(e,t){return!!e?.constructor&&!!t.classRegistry.getIdentifier(e.constructor)}var ns=s6(nt,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{let s=t.classRegistry.getAllowedProps(e.constructor);if(!s)return{...e};let n={};return s.forEach(t=>{n[t]=e[t]}),n},(e,t,s)=>{let n=s.classRegistry.getValue(t[1]);if(!n)throw Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(n.prototype),e)}),nn=s6((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,s)=>{let n=s.customTransformerRegistry.findByName(t[1]);if(!n)throw Error("Trying to deserialize unknown custom value");return n.deserialize(e)}),ni=[ns,s9,nn,ne],nr=(e,t)=>{let s=sL(ni,s=>s.isApplicable(e,t));if(s)return{value:s.transform(e,t),type:s.annotation(e,t)};let n=sL(s8,s=>s.isApplicable(e,t));if(n)return{value:n.transform(e,t),type:n.annotation}},no={};s8.forEach(e=>{no[e.annotation]=e});var nc=(e,t,s)=>{if(sY(t))switch(t[0]){case"symbol":return s9.untransform(e,t,s);case"class":return ns.untransform(e,t,s);case"custom":return nn.untransform(e,t,s);case"typed-array":return ne.untransform(e,t,s);default:throw Error("Unknown transformation: "+t)}else{let n=no[t];if(!n)throw Error("Unknown transformation: "+t);return n.untransform(e,s)}},na=(e,t)=>{if(t>e.size)throw Error("index out of bounds");let s=e.keys();for(;t>0;)s.next(),t--;return s.next().value};function nh(e){if(sM(e,"__proto__"))throw Error("__proto__ is not allowed as a property");if(sM(e,"prototype"))throw Error("prototype is not allowed as a property");if(sM(e,"constructor"))throw Error("constructor is not allowed as a property")}var nl=(e,t)=>{nh(t);for(let s=0;s<t.length;s++){let n=t[s];if(sG(e))e=na(e,+n);else if(sV(e)){let i=+n,r=0==+t[++s]?"key":"value",o=na(e,i);switch(r){case"key":e=o;break;case"value":e=e.get(o)}}else e=e[n]}return e},np=(e,t,s)=>{if(nh(t),0===t.length)return s(e);let n=e;for(let e=0;e<t.length-1;e++){let s=t[e];if(sY(n))n=n[+s];else if(sq(n))n=n[s];else if(sG(n))n=na(n,+s);else if(sV(n)){if(e===t.length-2)break;let i=+s,r=0==+t[++e]?"key":"value",o=na(n,i);switch(r){case"key":n=o;break;case"value":n=n.get(o)}}}let i=t[t.length-1];if(sY(n)?n[+i]=s(n[+i]):sq(n)&&(n[i]=s(n[i])),sG(n)){let e=na(n,+i),t=s(e);e!==t&&(n.delete(e),n.add(t))}if(sV(n)){let e=na(n,+t[t.length-2]);switch(0==+i?"key":"value"){case"key":{let t=s(e);n.set(t,n.get(e)),t!==e&&n.delete(e);break}case"value":n.set(e,s(n.get(e)))}}return e},nu=(e,t)=>sq(e)||sY(e)||sV(e)||sG(e)||nt(e,t),nd=(e,t,s,n,i=[],r=[],o=new Map)=>{let c=s0(e);if(!c){!function(e,t,s){let n=s.get(e);n?n.push(t):s.set(e,[t])}(e,i,t);let s=o.get(e);if(s)return n?{transformedValue:null}:s}if(!nu(e,s)){let t=nr(e,s),n=t?{transformedValue:t.value,annotations:[t.type]}:{transformedValue:e};return c||o.set(e,n),n}if(sM(r,e))return{transformedValue:null};let a=nr(e,s),h=a?.value??e,l=sY(h)?[]:{},p={};sD(h,(c,a)=>{if("__proto__"===a||"constructor"===a||"prototype"===a)throw Error(`Detected property ${a}. This is a prototype pollution risk, please remove it from your object.`);let h=nd(c,t,s,n,[...i,a],[...r,e],o);l[a]=h.transformedValue,sY(h.annotations)?p[a]=h.annotations:sq(h.annotations)&&sD(h.annotations,(e,t)=>{p[s2(a)+"."+t]=e})});let u=sW(p)?{transformedValue:l,annotations:a?[a.type]:void 0}:{transformedValue:l,annotations:a?[a.type,p]:p};return c||o.set(e,u),u};function nm(e){return Object.prototype.toString.call(e).slice(8,-1)}function nw(e){return"Array"===nm(e)}n=function(e){return"Null"===nm(e)},i=function(e){return"Undefined"===nm(e)};var nf=class{constructor({dedupe:e=!1}={}){this.classRegistry=new sC,this.symbolRegistry=new sj(e=>e.description??""),this.customTransformerRegistry=new sB,this.allowedErrorProps=[],this.dedupe=e}serialize(e){let t=new Map,s=nd(e,t,this,this.dedupe),n={json:s.transformedValue};s.annotations&&(n.meta={...n.meta,values:s.annotations});let i=function(e,t){let s;let n={};return(e.forEach(e=>{if(e.length<=1)return;t||(e=e.map(e=>e.map(String)).sort((e,t)=>e.length-t.length));let[i,...r]=e;0===i.length?s=r.map(s4):n[s4(i)]=r.map(s4)}),s)?sW(n)?[s]:[s,n]:sW(n)?void 0:n}(t,this.dedupe);return i&&(n.meta={...n.meta,referentialEqualities:i}),n}deserialize(e){let{json:t,meta:s}=e,n=function e(t,s={}){return nw(t)?t.map(t=>e(t,s)):!function(e){if("Object"!==nm(e))return!1;let t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}(t)?t:[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)].reduce((n,i)=>{if(nw(s.props)&&!s.props.includes(i))return n;let r=e(t[i],s);return!function(e,t,s,n,i){let r=({}).propertyIsEnumerable.call(n,t)?"enumerable":"nonenumerable";"enumerable"===r&&(e[t]=s),i&&"nonenumerable"===r&&Object.defineProperty(e,t,{value:s,enumerable:!1,writable:!0,configurable:!0})}(n,i,r,t,s.nonenumerable),n},{})}(t);if(s?.values){var i,r,o;i=n,r=s.values,o=this,function e(t,s,n=[]){if(!t)return;if(!sY(t)){sD(t,(t,i)=>e(t,s,[...n,...s3(i)]));return}let[i,r]=t;r&&sD(r,(t,i)=>{e(t,s,[...n,...s3(i)])}),s(i,n)}(r,(e,t)=>{i=np(i,t,t=>nc(t,e,o))}),n=i}return s?.referentialEqualities&&(n=function(e,t){function s(t,s){let n=nl(e,s3(s));t.map(s3).forEach(t=>{e=np(e,t,()=>n)})}if(sY(t)){let[n,i]=t;n.forEach(t=>{e=np(e,s3(t),()=>e)}),i&&sD(i,s)}else sD(t,s);return e}(n,s.referentialEqualities)),n}stringify(e){return JSON.stringify(this.serialize(e))}parse(e){return this.deserialize(JSON.parse(e))}registerClass(e,t){this.classRegistry.register(e,t)}registerSymbol(e,t){this.symbolRegistry.register(e,t)}registerCustom(e,t){this.customTransformerRegistry.register({name:t,...e})}allowErrorProps(...e){this.allowedErrorProps.push(...e)}};nf.defaultInstance=new nf,nf.serialize=nf.defaultInstance.serialize.bind(nf.defaultInstance),nf.deserialize=nf.defaultInstance.deserialize.bind(nf.defaultInstance),nf.stringify=nf.defaultInstance.stringify.bind(nf.defaultInstance),nf.parse=nf.defaultInstance.parse.bind(nf.defaultInstance),nf.registerClass=nf.defaultInstance.registerClass.bind(nf.defaultInstance),nf.registerSymbol=nf.defaultInstance.registerSymbol.bind(nf.defaultInstance),nf.registerCustom=nf.defaultInstance.registerCustom.bind(nf.defaultInstance),nf.allowErrorProps=nf.defaultInstance.allowErrorProps.bind(nf.defaultInstance),nf.serialize,nf.deserialize,nf.stringify,nf.parse,nf.registerClass,nf.registerCustom,nf.registerSymbol,nf.allowErrorProps;var nx=e=>{try{return nf.parse(e)}catch{return e}},ny=async function(e,t){let s=e.req.query(),n={};for(let[e,t]of Object.entries(s))n[e]=nx(t);e.set("__parsed_query",n),await t()},ng=async function(e,t){let s=await e.req.json(),n={};for(let[e,t]of Object.entries(s))n[e]=nx(t);e.set("__parsed_body",n),await t()},nb=class extends p.${_metadata;_errorHandler=void 0;config(e){return e&&(this._metadata.config=e),this}get handler(){return this}constructor(e={}){super(),this._metadata={subRouters:{},config:{},procedures:{},registeredPaths:[]},this.onError=e=>(this._errorHandler=e,this),this.setupRoutes(e)}registerSubrouterMiddleware(){this.use(async(e,t)=>{let[s,n]=e.req.path.split("/").filter(Boolean).slice(0,2),i=`/${s}/${n}`,r=await this._metadata.subRouters[i];if(r){let t="/"+e.req.path.split("/").slice(3).join("/"),s=new URL(e.req.url);s.pathname=t;let n=new Request(s,e.req.raw);return await r.fetch(n,e.env)}return t()})}setupRoutes(e){Object.entries(e).forEach(([e,t])=>{let s=`/${e}`;this._metadata.procedures[e]||(this._metadata.procedures[e]={type:t.type});let n=t.middlewares.map(e=>async(t,s)=>{let n=t.get("__middleware_output")??{},i=async e=>(Object.assign(n,e),n),r=await e({ctx:n,next:i,c:t});r&&Object.assign(n,r),t.set("__middleware_output",n),await s()});"get"===t.type?t.schema?this.get(s,ny,...n,async e=>{let s=e.get("__middleware_output")||{},n=e.get("__parsed_query"),i=0===Object.keys(n||{}).length?void 0:n,r=t.schema?.parse(i),o=await t.handler({c:e,ctx:s,input:r});return void 0===o?e.json(void 0):o}):this.get(s,...n,async e=>{let s=e.get("__middleware_output")||{},n=await t.handler({c:e,ctx:s,input:void 0});return void 0===n?e.json(void 0):n}):"post"===t.type?t.schema?this.post(s,ng,...n,async e=>{let s=e.get("__middleware_output")||{},n=e.get("__parsed_body"),i=0===Object.keys(n||{}).length?void 0:n,r=t.schema?.parse(i),o=await t.handler({c:e,ctx:s,input:r});return void 0===o?e.json(void 0):o}):this.post(s,...n,async e=>{let s=e.get("__middleware_output")||{},n=await t.handler({c:e,ctx:s,input:void 0});return void 0===n?e.json(void 0):n}):"ws"===t.type&&this.get(s,ny,...n,async e=>{let{UPSTASH_REDIS_REST_URL:s,UPSTASH_REDIS_REST_TOKEN:n}=(0,u._K)(e);if(!s||!n)throw new h.y(503,{message:"Missing required environment variables for WebSockets connection.\n\nReal-time WebSockets depend on a persistent connection layer to maintain communication. JStack uses Upstash Redis to achieve this.To fix this error:\n1. Log in to Upstash Redis at https://upstash.com\n2. Add UPSTASH_REDIS_REST_URL and UPSTASH_REDIS_REST_TOKEN to your environment variables\n\nComplete WebSockets guide: https://jstack.app/docs/websockets\n"});let i=e.get("__middleware_output")||{},{0:r,1:o}=new WebSocketPair;o.accept();let c=new sI(s,n),a=await t.handler({io:c,c:e,ctx:i}),p=new d.fc(o,{redisUrl:s,redisToken:n,incomingSchema:t.incoming,outgoingSchema:t.outgoing});a.onConnect?.({socket:p}),o.addEventListener("close",async()=>{p.close(),await a.onDisconnect?.({socket:p})}),o.addEventListener("error",async e=>{p.close(),await a.onError?.({socket:p,error:e})});let m=l.z.tuple([l.z.string(),l.z.unknown()]);return o.addEventListener("message",async e=>{try{let t=l.z.string().parse(e.data),s=JSON.parse(t),[n,i]=m.parse(s);if("ping"===n){o.send(JSON.stringify(["pong",null]));return}p.handleEvent(n,i)}catch(e){d.vF.error("Failed to process message:",e)}}),new Response(null,{status:101,webSocket:r})})})}};function nO(e,t){let s=new nb;for(let[n,i]of(Object.assign(s,e),s._metadata={subRouters:{},config:{},procedures:{},registeredPaths:[]},Object.entries(t)))if("function"==typeof i){let e=new nb;e.all("*",async e=>{let t=await i();return s._metadata.subRouters[`/api/${n}`]=t,t.fetch(e.req.raw,e.env)}),s._metadata.subRouters[`/api/${n}`]=e}else i instanceof nb&&(s._metadata.subRouters[`/api/${n}`]=i);return s.registerSubrouterMiddleware(),s}var nS=class e{middlewares=[];inputSchema;incomingSchema;outgoingSchema;superjsonMiddleware=async function({c:e,next:t}){return e.superjson=(t,s)=>{let n=nf.stringify(t);return e.newResponse(n,s,{...Object.fromEntries(e.res.headers.entries()),"x-is-superjson":"true"})},t()};constructor(e=[],t,s,n){this.middlewares=e,this.inputSchema=t,this.incomingSchema=s,this.outgoingSchema=n,this.middlewares.some(e=>"superjsonMiddleware"===e.name)||this.middlewares.push(this.superjsonMiddleware)}incoming(t){return new e(this.middlewares,this.inputSchema,t,this.outgoingSchema)}outgoing(t){return new e(this.middlewares,this.inputSchema,this.incomingSchema,t)}input(t){return new e(this.middlewares,t,this.incomingSchema,this.outgoingSchema)}use(t){return new e([...this.middlewares,t],this.inputSchema,this.incomingSchema,this.outgoingSchema)}get(e){return{type:"get",schema:this.inputSchema,handler:e,middlewares:this.middlewares}}query(e){return this.get(e)}post(e){return{type:"post",schema:this.inputSchema,handler:e,middlewares:this.middlewares}}mutation(e){return this.post(e)}ws(e){return{type:"ws",outputFormat:"ws",handler:e,middlewares:this.middlewares}}},nE=(e={})=>new nb(e);function nR(e){return async({c:t,next:s})=>{await e(t,async()=>await s())}}new class{init(){return{router:nE,mergeRouters:nO,middleware:e=>e,fromHono:nR,procedure:new nS,defaults:{cors:(0,a.W)({allowHeaders:["x-is-superjson"],exposeHeaders:["x-is-superjson"],origin:e=>e,credentials:!0}),errorHandler:e=>(console.error("[API Error]",e),e instanceof h.y)?e.getResponse():e instanceof l.G?new h.y(422,{message:"Validation error",cause:e}).getResponse():"status"in e&&"number"==typeof e.status?new h.y(e.status,{message:e.message||"API Error",cause:e}).getResponse():new h.y(500,{message:"An unexpected error occurred. Check server logs for details.",cause:e}).getResponse()}}}};var nv=e=>{let{baseUrl:t="",credentials:s="include",...n}=e??{},i=async(e,n)=>{let i=e.toString().replace(t,""),r=t+i,o=await fetch(r,{...n,credentials:s,cache:"no-store"});if(!o.ok){let e=await o.text();throw new h.y(o.status,{message:e,res:o})}return o.json=()=>nA(o),o};return function e(t,s,n=[]){return new Proxy(t,{get(t,i,r){if("string"==typeof i){let r=[...n,i];return"$get"===i?async(...e)=>{let[s,n]=e,i=nT(s);return t.$get({query:i},n)}:"$post"===i?async(...e)=>{let[s,n]=e,i=nT(s);return t.$post({json:i},n)}:"$url"===i?e=>{let t=`/${r.slice(0,-1).join("/")}`.replace(s,""),n=new URL(s+t);return e?.query&&Object.entries(e.query).forEach(([e,t])=>{n.searchParams.append(e,String(t))}),n}:"$ws"===i?()=>{let e=`/${r.slice(0,-1).join("/")}`.replace(s,""),t=new URL(s+e);return t.protocol="https:"===t.protocol?"wss:":"ws:",new d.nO(t)}:e(t[i],s,r)}return Reflect.get(t,i,r)}})}((0,m.hc)(t,{...n,fetch:n.fetch||i}),t)},nA=async e=>{let t=await e.text(),s="true"===e.headers.get("x-is-superjson");try{return s?nf.parse(t):JSON.parse(t)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("Invalid JSON response")}};function nT(e){return"object"!=typeof e||null===e?e:Object.fromEntries(Object.entries(e).map(([e,t])=>[e,nf.stringify(t)]))}}}]);